<!DOCTYPE html>
<html lang="ja" ng-app="DaysChart">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta http-equiv="Content-Security-Policy" content="default-src * data:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">

	<title>DaysChart</title>

	<script src="angular/angular.js"></script>

	<script src="onsenui/js/onsenui.js"></script>
	<script src="onsenui/js/angular-onsenui.js"></script>

	<link rel="stylesheet" href="onsenui/css/onsenui.css">
	<link rel="stylesheet" href="onsenui/css/onsen-css-components.css">

	<script>
	var pidNewPostDialog;
	var module = angular.module('DaysChart', ['onsen']);

	ons.ready(function() {
		// 新規追加のダイアログ設定
		ons.createPopover('newPostDialog.html').then(function(popover) {
			pidNewPostDialog = popover;
		});
	});

	module.controller('AppController', function($scope, $timeout) {
		$scope.todayPosts = [
			{ "text" : "Wellcome ! How do yo do ?" },
			{ "text" : "卒論の進捗ダメです" },
			{ "text" : "あああああ" }
		];


		$scope.alert = function(message) {
			ons.notification.alert(message);
		};


		$scope.showNewPostDialog = function() {
			pidNewPostDialog.show("#btNewPostDialog");
		};
		$scope.hideNewPostDialog = function() {
			pidNewPostDialog.hide();
		};

		// 新規追加
		$scope.addTodayPost = function() {
			var text = document.getElementById("newPostText").value;
			if (text.length <= 0) {
				$scope.hideNewPostDialog();
				ons.notification.alert("Message is unjust.");
				return;
			}

			if (text.length > 200) {
				$scope.hideNewPostDialog();
				ons.notification.alert("Message over 200 char.");
				return;
			}

			var data = { "text" : text };
			$scope.todayPosts.unshift(data);
			document.getElementById("newPostText").value = "";
			$scope.hideNewPostDialog();
		};
	});
	</script>
</head>

<body ng-controller="AppController">
<ons-page>
	<ons-toolbar>
		<div class="center" style="width: 100%">
			DaysChart
		</div>
		<div class="right">
			<ons-toolbar-button id="btNewPostDialog" component="button/new-task" ng-click="showNewPostDialog()">New</ons-toolbar-button>
		</div>
	</ons-toolbar>
	<ons-tabbar var="tabbar" position="auto">
		<ons-tab page="home.html" active ng-attr-icon="ion-ios-home" label="Home"></ons-tab>
		<ons-tab page="history.html" ng-attr-icon="ion-ios-clock-outline" label="Days"></ons-tab>
	</ons-tabbar>
</ons-page>


<template id="home.html">
<ons-page>
	<ons-card ng-repeat="item in todayPosts">
		<div style="text-align: center; font-size: 16px;">
			{{ item.text }}
		</div>
	</ons-card>
</ons-page>
</template> <!-- home.html -->


<template id="history.html">
<ons-page>
	<ons-card>
		<div style="text-align: center; font-size: 24px;">
			<strong>ようこそ！</strong><br>
			今日の調子はどう？
		</div>
	</ons-card>

	<ons-list>
		<ons-list-header>Recently</ons-list-header>
		<ons-list-item modifier="chevron" tappable>10/18</ons-list-item>
		<ons-list-item modifier="chevron" tappable>10/17</ons-list-item>
		<ons-list-item modifier="chevron" tappable>10/16</ons-list-item>
	</ons-list>
</ons-page>
</template> <!-- history.html -->


<template id="newPostDialog.html">
<ons-popover cancelable cover-target>
	<div style="text-align: center;">
		<p style="font-size: 16px;">メモる</p>
		<textarea id="newPostText" class="textarea" rows="5" placeholder="いま何してる？"></textarea>
		<br><br>
		<ons-button ng-click="addTodayPost()">Post</ons-button>
		<ons-button ng-click="hideNewPostDialog()">Cancel</ons-button>
	</div>
</ons-popover>
</template> <!-- newPostDialog.html -->


</body>
</html>
